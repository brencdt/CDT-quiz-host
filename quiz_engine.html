<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiesa di Totti Calcio Quiz Engine</title>
    <style>
        /* Base styling for the document body */
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: 'Inter', Helvetica, Arial, sans-serif;
            color: #222;
        }

        /* Quiz Container Styles */
        #roma-quiz {
            max-width: 100%;
            padding: 22px;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        /* Loading/Error Message Style */
        #quiz-area {
            flex-grow: 1;
        }

        /* Header Styles */
        .quiz-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 18px;
        }

        .quiz-header img {
            height: 60px;
            width: auto;
            display: block;
        }

        .quiz-header h2 {
            color: #8E1B1B;
            margin: 0;
            font-size: 1.4rem;
        }

        /* Option Button Base Styles */
        #quiz-options {
            display:flex;
            flex-direction:column;
            gap:10px;
        }

        #quiz-options button {
            background: #fafafa;
            border: 1px solid #e6e6e6;
            padding: 12px 14px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s, color 0.2s, border-color 0.2s;
            width: 100%;
        }

        /* Next Button Styles */
        #quiz-next {
            margin-top: 14px;
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            background: #8E1B1B;
            color: #fff;
            cursor: pointer;
            font-weight: 700;
        }

        /* Result Text Style */
        #quiz-result {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            color: #8E1B1B;
            background-color: #f7eaea;
            font-weight: 700;
        }
        
        .loading-text {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 50px 0;
        }
    </style>
</head>
<body>
    <div id="roma-quiz">
        <div class="quiz-header">
            <img src="https://platform.sbnation.com/wp-content/uploads/sites/2/team-logos/logo-chiesaditotti.png?w=224" alt="Chiesa di Totti logo">
            <h2>Chiesa di Totti Calcio Quiz</h2>
        </div>

        <div id="quiz-area">
            <!-- Content dynamically loaded here -->
            <div id="quiz-question" style="font-weight:700;margin:12px 0 8px;">Loading quiz data...</div>
            <div id="quiz-options"></div>
            <button id="quiz-next" style="display:none;">Next</button>
            <div id="quiz-result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const DATA_URL = 'quiz_data.json'; 

        // Default data used as a fallback when running in the local editor (where fetch fails)
        const DEFAULT_QUIZ_DATA = [
            { 
                "q": "Who was AS Roma‚Äôs first-ever captain in Serie A?", 
                "a": [
                    {"t":"Attilio Ferraris", "c":true},
                    {"t":"Fulvio Bernardini", "c":false},
                    {"t":"Guido Masetti", "c":false},
                    {"t":"Amedeo Amadei", "c":false}
                ]
            },
            { 
                "q": "In which season did Francesco Totti win the European Golden Shoe?", 
                "a": [
                    {"t":"2005‚Äì06", "c":false},
                    {"t":"2006‚Äì07", "c":true},
                    {"t":"2007‚Äì08", "c":false},
                    {"t":"2003‚Äì04", "c":false}
                ]
            },
            { 
                "q": "Which manager led Roma to their 2000‚Äì01 Serie A title?", 
                "a": [
                    {"t":"Fabio Capello", "c":true},
                    {"t":"Luciano Spalletti", "c":false},
                    {"t":"Zdenƒõk Zeman", "c":false},
                    {"t":"Rudi Garcia", "c":false}
                ]
            }
        ];

        document.addEventListener("DOMContentLoaded", function() {
            const q = document.getElementById("quiz-question");
            const opts = document.getElementById("quiz-options");
            const nextBtn = document.getElementById("quiz-next");
            const result = document.getElementById("quiz-result");

            let quizData = [];
            let i = 0, score = 0;

            async function loadQuizData() {
                q.textContent = 'Loading quiz data...';
                
                // Check if running in the local editor environment (which uses the 'blob:' protocol)
                if (window.location.protocol === 'blob:') {
                    // This prevents the TypeError from appearing in the console
                    console.log("Running in local editor. Loading default data.");
                    quizData = DEFAULT_QUIZ_DATA; 
                    q.textContent = 'Note: Running default quiz for local preview.';
                    showQuestion();
                    return;
                }
                
                // If not in the local editor (i.e., on GitHub Pages), attempt the external fetch
                try {
                    const response = await fetch(DATA_URL);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    quizData = await response.json();
                    
                    if (quizData.length === 0) {
                        q.textContent = 'Error: The quiz data file is empty. Please check quiz_data.json.';
                        return;
                    }
                    console.log("Quiz data loaded successfully from external JSON.");
                    showQuestion();
                } catch (error) {
                    // This catch block handles production errors (e.g., 404 on GitHub, or malformed JSON)
                    console.error("Error loading quiz data (check GitHub files).", error);
                    q.textContent = 'Error: Quiz data loading failed. Please check your GitHub files.';
                    return;
                }
            }

            function showQuestion() {
                const item = quizData[i];
                q.textContent = (i+1) + ". " + item.q;
                opts.innerHTML = "";
                nextBtn.style.display = "none";
                result.style.display = "none";

                item.a.forEach(opt => {
                    const btn = document.createElement("button");
                    btn.textContent = opt.t;
                    
                    btn.onmouseover = () => btn.style.background = '#f0f0f0';
                    btn.onmouseout = () => btn.style.background = '#fafafa';

                    btn.onclick = () => {
                        Array.from(opts.children).forEach(b => {
                            b.disabled = true;
                            b.onmouseover = null;
                            b.onmouseout = null;
                        });
                        
                        btn.style.background = '#fafafa'; 
                        
                        if (opt.c) {
                            btn.style.background = "#8E1B1B";
                            btn.style.color = "#fff";
                            score++;
                        } else {
                            btn.style.background = "#f3f3f3";
                            btn.style.color = "#666";
                            const correct = item.a.findIndex(o => o.c);
                            opts.children[correct].style.background = "#8E1B1B";
                            opts.children[correct].style.color = "#fff";
                        }
                        nextBtn.style.display = "inline-block";
                    };
                    opts.appendChild(btn);
                });
            }

            nextBtn.onclick = () => {
                i++;
                if (i < quizData.length) showQuestion();
                else showResult();
            };

            function showResult() {
                q.textContent = "";
                opts.innerHTML = "";
                nextBtn.style.display = "none";
                result.style.display = "block";
                const pct = Math.round((score / quizData.length) * 100);
                let msg = "";
                if (pct === 100) msg = "üèÜ Perfect ‚Äî you know your Giallorossi history inside out.";
                else if (pct >= 60) msg = "üëè Nice ‚Äî solid Roma knowledge.";
                else msg = "üí≠ Time to hit the archives on Chiesa di Totti.";
                result.textContent = `You scored ${score}/${quizData.length} (${pct}%). ${msg}`;
            }

            loadQuizData(); 
        });
    </script>
</body>
</html>
